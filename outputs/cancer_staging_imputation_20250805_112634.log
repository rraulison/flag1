2025-08-05 11:26:34,611 - flag1.src.pipeline - INFO - Initializing pipeline components...
2025-08-05 11:26:34,611 - flag1.src.pipeline - INFO - Pipeline initialized successfully. Output will be saved to: /home/remo/inca/flag1/outputs/cancer_staging_imputation_20250805_112634
2025-08-05 11:26:34,611 - flag1.src.pipeline - INFO - ================================================================================
2025-08-05 11:26:34,611 - flag1.src.pipeline - INFO - STARTING PIPELINE EXECUTION - 2025-08-05 11:26:34.611746
2025-08-05 11:26:34,611 - flag1.src.pipeline - INFO - ================================================================================
2025-08-05 11:26:34,611 - flag1.src.pipeline - INFO - 
==================================================
2025-08-05 11:26:34,611 - flag1.src.pipeline - INFO - STEP 1/4: LOADING AND PREPROCESSING DATA
2025-08-05 11:26:34,611 - flag1.src.pipeline - INFO - ==================================================
2025-08-05 11:26:34,611 - flag1.src.data_processing - INFO - Loading data from /home/remo/inca/flag1/data/df_preprocessed.parquet
2025-08-05 11:26:35,141 - flag1.src.data_processing - INFO - Loading feature importance from /home/remo/inca/flag1/data/results/selected_features_cv.csv
2025-08-05 11:26:35,144 - flag1.src.data_processing - INFO - Selected 26 features.
2025-08-05 11:26:35,301 - flag1.src.data_processing - INFO - Distribution of flag_nao_estadiavel:
flag_nao_estadiavel
0.0    1420537
NaN    1053932
1.0     402028
Name: count, dtype: int64
2025-08-05 11:26:35,323 - flag1.src.data_processing - INFO - Distribution of estadiamento_ordinal:
estadiamento_ordinal
0.0      63256
1.0     299066
2.0     360358
3.0     345896
4.0     351961
NaN    1455960
Name: count, dtype: int64
2025-08-05 11:26:35,344 - flag1.src.data_processing - INFO - Columns with missing data: ['LOCTUDET', 'LOCTUPRI', 'OUTROESTA', 'DTTRIAGE', 'ANTRI', 'DATAINITRT', 'flag_nao_estadiavel', 'estadiamento_ordinal']
2025-08-05 11:26:35,346 - flag1.src.data_processing - INFO -   LOCTUDET: 3 missing values
2025-08-05 11:26:35,348 - flag1.src.data_processing - INFO -   LOCTUPRI: 3 missing values
2025-08-05 11:26:35,349 - flag1.src.data_processing - INFO -   OUTROESTA: 31596 missing values
2025-08-05 11:26:35,351 - flag1.src.data_processing - INFO -   DTTRIAGE: 379706 missing values
2025-08-05 11:26:35,353 - flag1.src.data_processing - INFO -   ANTRI: 379706 missing values
2025-08-05 11:26:35,354 - flag1.src.data_processing - INFO -   DATAINITRT: 495167 missing values
2025-08-05 11:26:35,357 - flag1.src.data_processing - INFO -   flag_nao_estadiavel: 1053932 missing values
2025-08-05 11:26:35,360 - flag1.src.data_processing - INFO -   estadiamento_ordinal: 1455960 missing values
2025-08-05 11:26:35,707 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: TNM
2025-08-05 11:26:36,040 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: CNES
2025-08-05 11:26:36,178 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: T
2025-08-05 11:26:36,512 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: MUUH
2025-08-05 11:26:36,637 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: LOCTUDET
2025-08-05 11:26:36,777 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: M
2025-08-05 11:26:36,899 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: LOCTUPRI
2025-08-05 11:26:37,224 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: PTNM
2025-08-05 11:26:37,501 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: UFUH
2025-08-05 11:26:37,800 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: PRITRATH
2025-08-05 11:26:37,938 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: N
2025-08-05 11:26:38,075 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: pT
2025-08-05 11:26:38,213 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: pM
2025-08-05 11:26:38,346 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: OUTROESTA
2025-08-05 11:26:38,618 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: CLITRAT
2025-08-05 11:26:38,756 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: ESTDFIMT
2025-08-05 11:26:39,032 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: ESTADRES
2025-08-05 11:26:39,382 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: CLIATEN
2025-08-05 11:26:39,521 - flag1.src.data_processing - INFO - Corrected categorical column to handle NaN as string: pN
2025-08-05 11:26:39,521 - flag1.src.pipeline - INFO - ✓ Data loaded and preprocessed successfully. Shape: (2876497, 28)
2025-08-05 11:26:39,521 - flag1.src.pipeline - INFO -   Features: 27 total, 19 categorical
2025-08-05 11:26:46,241 - flag1.src.pipeline - DEBUG - DataFrame memory usage: 2815.27 MB
2025-08-05 11:26:46,241 - flag1.src.pipeline - INFO - 
==================================================
2025-08-05 11:26:46,241 - flag1.src.pipeline - INFO - STEP 2/4: RUNNING IMPUTATION
2025-08-05 11:26:46,241 - flag1.src.pipeline - INFO - ==================================================
2025-08-05 11:26:46,241 - flag1.src.imputation - INFO - Starting imputation loop with 1 iterations.
2025-08-05 11:26:46,241 - flag1.src.imputation - INFO - Starting imputation 1/1
2025-08-05 11:26:51,063 - flag1.src.imputation - INFO - [Binary Model] Training with 15 features: ['CNES', 'MUUH', 'LOCTUDET', 'LOCTUPRI', 'UFUH', 'PRITRATH', 'CLITRAT', 'ESTADRES', 'CLIATEN', 'DTTRIAGE', 'ANTRI', 'DATAPRICON', 'obitcons', 'Quimioterapia_TRAT', 'DATAINITRT']
2025-08-05 11:26:51,063 - flag1.src.imputation - DEBUG - Excluded staging variables: ['TNM', 'OUTROESTA', 'T', 'N', 'M', 'pT', 'pN', 'pM', 'PTNM', 'ESTDFIMT', 'estadiamento_ordinal', 'flag_nao_estadiavel', 'flag_nao_estadiavel']
2025-08-05 11:26:51,063 - flag1.src.imputation - DEBUG - Original cat_idx: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 22]
2025-08-05 11:26:51,063 - flag1.src.imputation - DEBUG - Filtered cat_idx: [0, 1, 2, 3, 4, 5, 6, 7, 8]
2025-08-05 11:26:51,950 - flag1.src.imputation - DEBUG - Using scale_pos_weight=3.52 for binary classification
2025-08-05 11:28:45,630 - flag1.src.imputation - DEBUG - Applied temperature scaling: 0.5
2025-08-05 11:28:45,630 - flag1.src.imputation - DEBUG - Model type: binary
2025-08-05 11:28:45,630 - flag1.src.imputation - DEBUG - Model classes: [0 1]
2025-08-05 11:28:45,635 - flag1.src.imputation - DEBUG - Unique y_train values: [0 1]
2025-08-05 11:28:45,636 - flag1.src.imputation - DEBUG - Unique y_val values: [0 1]
2025-08-05 11:28:45,642 - flag1.src.imputation - DEBUG - Class distribution - Train: {0: np.int64(1135688), 1: np.int64(322364)}
2025-08-05 11:28:45,643 - flag1.src.imputation - DEBUG - Class distribution - Val: {0: np.int64(283922), 1: np.int64(80591)}
2025-08-05 11:28:45,644 - flag1.src.imputation - DEBUG - Top 10 important features for binary model:
2025-08-05 11:28:45,646 - flag1.src.imputation - DEBUG -        feature  importance
0         CNES   27.958211
3     LOCTUPRI   16.513200
11  DATAPRICON   10.591255
2     LOCTUDET    9.661187
6      CLITRAT    4.603283
5     PRITRATH    4.412783
8      CLIATEN    4.339582
10       ANTRI    4.259797
9     DTTRIAGE    3.889516
1         MUUH    3.607940
2025-08-05 11:28:46,967 - flag1.src.imputation - INFO - Binary model - Iter 1 - Val LogLoss: 0.2035 - Accuracy: 0.9363 - Classes: [0 1]
2025-08-05 11:28:46,970 - flag1.src.imputation - DEBUG - Top 10 important features:
       feature  importance
0         CNES   27.958211
3     LOCTUPRI   16.513200
11  DATAPRICON   10.591255
2     LOCTUDET    9.661187
6      CLITRAT    4.603283
5     PRITRATH    4.412783
8      CLIATEN    4.339582
10       ANTRI    4.259797
9     DTTRIAGE    3.889516
1         MUUH    3.607940
2025-08-05 11:28:48,034 - root - DEBUG - Processed 50000/1053932 samples (4.7%)
2025-08-05 11:28:51,058 - root - DEBUG - Processed 550000/1053932 samples (52.2%)
2025-08-05 11:28:53,981 - root - DEBUG - Processed 1050000/1053932 samples (99.6%)
2025-08-05 11:28:54,470 - flag1.src.imputation - INFO - Imputed 1053932 missing flags: 39.0% as 'não estadiável' (1), 61.0% as 'estadiável' (0)
2025-08-05 11:28:54,470 - flag1.src.imputation - INFO - Top 10 most important features for flag imputation:
2025-08-05 11:28:54,471 - flag1.src.imputation - INFO - CNES          27.958211
LOCTUPRI      16.513200
DATAPRICON    10.591255
LOCTUDET       9.661187
CLITRAT        4.603283
PRITRATH       4.412783
CLIATEN        4.339582
ANTRI          4.259797
DTTRIAGE       3.889516
MUUH           3.607940
2025-08-05 11:28:56,300 - flag1.src.imputation - INFO - [Ordinal Model] Training with 25 features.
2025-08-05 11:28:56,300 - flag1.src.imputation - DEBUG - Features used: ['TNM', 'CNES', 'T', 'MUUH', 'LOCTUDET', 'M', 'LOCTUPRI', 'PTNM', 'UFUH', 'PRITRATH', 'N', 'pT', 'pM', 'OUTROESTA', 'CLITRAT', 'ESTDFIMT', 'ESTADRES', 'CLIATEN', 'DTTRIAGE', 'ANTRI', 'DATAPRICON', 'obitcons', 'pN', 'Quimioterapia_TRAT', 'DATAINITRT']
2025-08-05 11:28:56,300 - flag1.src.imputation - DEBUG - Excluded variables: ['ESTADIAM', 'estadiamento_ordinal', 'flag_nao_estadiavel']
2025-08-05 11:29:03,134 - flag1.src.imputation - DEBUG - Training ordinal model with 1121254 samples. Class distribution:
estadiamento_ordinal
0     50784
1    237868
2    295889
3    281098
4    255615
Name: count, dtype: int64
2025-08-05 11:29:03,143 - flag1.src.imputation - DEBUG - Using class weights: {0: 4.415776622558286, 1: 0.9427531235811458, 2: 0.7578882621523612, 3: 0.7977673266974508, 4: 0.877299063044031}
2025-08-05 11:29:10,150 - root - DEBUG - Imputation 1 completed in 143.91s
